DROP TABLE IF EXISTS consultant_services;
DROP TABLE IF EXISTS services;
DROP TABLE IF EXISTS consultant_addresses;
DROP TABLE IF EXISTS consultant_countries;
DROP TABLE IF EXISTS consultants;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS cities;
DROP TABLE IF EXISTS states;
DROP TABLE IF EXISTS countries;
DROP TABLE IF EXISTS regions;


CREATE TABLE users (
    id INT(6) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(60) NOT NULL,
    role VARCHAR (50) NOT NULL DEFAULT 'member');

CREATE TABLE regions (
    id INT(2) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    region VARCHAR(20) NOT NULL);

CREATE TABLE countries(
    id INT(3) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    country VARCHAR(30) NOT NULL,
    region_id INT(2) NOT NULL,
    is_consultant_country BOOLEAN NOT NULL,
    hasStates BOOLEAN DEFAULT 0,
    FOREIGN KEY(region_id) REFERENCES regions(id));

CREATE TABLE consultants(
    id INT(6) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_id INT(6) UNIQUE NOT NULL,
    first_name VARCHAR(60),
    last_name VARCHAR(40),
    about VARCHAR(200),
    phone_number VARCHAR(12),
    profile_picture_url VARCHAR(150) DEFAULT '/images/default-profile-picture.png',
    country_id INT(3),
    FOREIGN KEY(user_id) REFERENCES users(id),
    FOREIGN KEY(country_id) REFERENCES countries(id));

CREATE TABLE consultant_countries(
    id INT(8) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_id INT(6) NOT NULL,
    country_id INT(3) NOT NULL,
	FOREIGN KEY(user_id) REFERENCES consultants(user_id),
	FOREIGN KEY(country_id) REFERENCES countries(id));

CREATE TABLE services(
    id INT(3) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    service VARCHAR(30) NOT NULL);

CREATE TABLE consultant_services(
    id INT(8) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_id INT(6) NOT NULL,
    service_id INT(3) NOT NULL,
    FOREIGN KEY(user_id) REFERENCES consultants(user_id),
    FOREIGN KEY(service_id) REFERENCES services(id));

CREATE TABLE states(
    id INT(5) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    state VARCHAR(30) NOT NULL,
    country_id INT(3) NOT NULL,
    FOREIGN KEY(country_id) REFERENCES countries(id));

CREATE TABLE cities(
    id INT(6) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    city VARCHAR(30) NOT NULL,
    state_id INT(5),
    country_id INT(3) NOT NULL,
    FOREIGN KEY(state_id) REFERENCES states(id),
    FOREIGN KEY(country_id) REFERENCES countries(id));

CREATE TABLE consultant_addresses(
    id INT(8) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_id INT(6) NOT NULL,
    city_id INT(6) NOT NULL,
    address VARCHAR(200) NOT NULL,
    is_primary BOOLEAN DEFAULT 0,
    FOREIGN KEY(user_id) REFERENCES consultants(user_id),
    FOREIGN KEY(city_id) REFERENCES cities(id));

DELIMITER $$
CREATE TRIGGER consultant_creator_trigger
AFTER INSERT ON users
FOR EACH ROW
BEGIN
IF (NEW.role = 'consultant')
THEN INSERT INTO consultants (user_id) VALUES (NEW.id);
END IF;
END$$
DELIMITER ;

INSERT INTO users (email, role) VALUES ('dincercetiner@hotmail.com', 'consultant');

INSERT INTO regions (region) VALUES ('North America');
INSERT INTO regions (region) VALUES ('Europe');
INSERT INTO regions (region) VALUES ('Asia');

INSERT INTO countries (country, region_id, is_consultant_country, hasStates) VALUES ('United States', 1, true, true);
INSERT INTO countries (country, region_id, is_consultant_country, hasStates) VALUES ('United Kingdom', 2, true, false);
INSERT INTO countries (country, region_id, is_consultant_country, hasStates) VALUES ('Germany', 2, true, true);
INSERT INTO countries (country, region_id, is_consultant_country, hasStates) VALUES ('Canada', 1, true, true);
INSERT INTO countries (country, region_id, is_consultant_country, hasStates) VALUES ('China', 3, true, true);
INSERT INTO countries (country, region_id, is_consultant_country, hasStates) VALUES ('Japan', 3, true, true);
INSERT INTO countries (country, region_id, is_consultant_country, hasStates) VALUES ('Turkey', 2, true, false);

INSERT INTO states (state, country_id) VALUES ('New York', 1);
INSERT INTO states (state, country_id) VALUES ('California', 1);
INSERT INTO states (state, country_id) VALUES ('Massachusetts', 1);

INSERT INTO cities (city, state_id, country_id) VALUES ('New York', 1, 1);
INSERT INTO cities (city, state_id, country_id) VALUES ('Los Angeles', 2, 1);
INSERT INTO cities (city, state_id, country_id) VALUES ('Boston', 3, 1);
INSERT INTO cities (city, country_id) VALUES ('Ä°stanbul', 7);
INSERT INTO cities (city, country_id) VALUES ('Ankara', 7);
INSERT INTO cities (city, country_id) VALUES ('Adana', 7);

INSERT INTO services (service) VALUES ('High School Education');
INSERT INTO services (service) VALUES ('University Education');
INSERT INTO services (service) VALUES ('Language School');