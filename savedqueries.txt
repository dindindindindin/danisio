DROP TABLE IF EXISTS consultant_services;
DROP TABLE IF EXISTS consultant_addresses;
DROP TABLE IF EXISTS consultant_countries;
DROP TABLE IF EXISTS consultants;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS countries;
DROP TABLE IF EXISTS services;


CREATE TABLE users (
    id INT(6) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(60) NOT NULL,
    role VARCHAR (50) NOT NULL DEFAULT 'member');

CREATE TABLE countries(
    id INT(3) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(20),
    region VARCHAR(20));

CREATE TABLE consultants(
    id INT(6) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_id INT(6) UNIQUE NOT NULL,
    first_name VARCHAR(60),
    last_name VARCHAR(40),
    about VARCHAR(200),
    phone_number VARCHAR(12),
    profile_picture_url VARCHAR(150) DEFAULT '/images/default-profile-picture.png',
    country_id INT(3),
    FOREIGN KEY(user_id) REFERENCES users(id),
    FOREIGN KEY(country_id) REFERENCES countries(id));

CREATE TABLE consultant_countries(
    id INT(8) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_id INT(6) NOT NULL,
    country_id INT(3) NOT NULL,
	FOREIGN KEY(user_id) REFERENCES consultants(user_id),
	FOREIGN KEY(country_id) REFERENCES countries(id));

CREATE TABLE services(
    id INT(3) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    service VARCHAR(30) NOT NULL);

CREATE TABLE consultant_services(
    id INT(8) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_id INT(6) NOT NULL,
    service_id INT(3) NOT NULL,
    FOREIGN KEY(user_id) REFERENCES consultants(user_id),
    FOREIGN KEY(service_id) REFERENCES services(id));

CREATE TABLE consultant_addresses(
    id INT(8) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_id INT(6) NOT NULL,
    city VARCHAR(20),
    address VARCHAR(200),
    is_primary BOOLEAN DEFAULT 0,
    FOREIGN KEY(user_id) REFERENCES consultants(user_id));

DELIMITER $$
CREATE TRIGGER consultant_creator_trigger
AFTER INSERT ON users
FOR EACH ROW
BEGIN
IF (NEW.role = 'consultant')
THEN INSERT INTO consultants (user_id) VALUES (NEW.id);
END IF;
END$$
DELIMITER ;

INSERT INTO users (email, role) VALUES ('dincercetiner@hotmail.com', 'consultant');

INSERT INTO countries (name, region) VALUES ('United States', 'North America');
INSERT INTO countries (name, region) VALUES ('United Kingdom', 'Europe');
INSERT INTO countries (name, region) VALUES ('Germany', 'Europe');
INSERT INTO countries (name, region) VALUES ('Canada', 'North America');
INSERT INTO countries (name, region) VALUES ('China', 'Asia');
INSERT INTO countries (name, region) VALUES ('Japan', 'Asia');

INSERT INTO services (service) VALUES ('High School');
INSERT INTO services (service) VALUES ('University');
INSERT INTO services (service) VALUES ('Language School');